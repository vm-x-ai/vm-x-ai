# Example values for production environment
# Usage: helm install vm-x-ai ./helm/vm-x-ai -f values-production.yaml

# Production-ready settings
api:
  replicaCount: 3
  resources:
    requests:
      cpu: 1000m
      memory: 1Gi
    limits:
      cpu: 4000m
      memory: 4Gi
  podDisruptionBudget:
    enabled: true
    minAvailable: 2
  timeseriesDb:
    provider: aws-timestream
    awsTimestream:
      databaseName: 'vmxai-production'
  encryption:
    provider: aws-kms # Recommended for production
    awsKms:
      keyId: 'arn:aws:kms:us-east-1:123456789012:key/12345678-1234-1234-1234-123456789012'

ui:
  replicaCount: 3
  resources:
    requests:
      cpu: 200m
      memory: 256Mi
    limits:
      cpu: 1000m
      memory: 1Gi

# Use external PostgreSQL (recommended for production)
postgresql:
  enabled: false
  external:
    host: 'postgres.example.com'
    port: 5432
    database: 'vmxai'
    username: 'admin'
    # password should be set via secret

  persistence:
    storageClass: 'fast-ssd'

# Use Redis cluster for production
redis:
  enabled: true
  mode: cluster
  cluster:
    nodes: 6
    replicas: 1
    persistence:
      enabled: true
      size: 50Gi
      storageClass: 'fast-ssd'

# Use external QuestDB or AWS Timestream (recommended for production)
questdb:
  enabled: false

# Encryption is configured via api.encryption.provider (aws-kms recommended for production)

# Enable ingress with TLS using Istio
ingress:
  type: istio
  enabled: true
  istio:
    # Host configuration - defined once, used in Gateway servers and VirtualService
    host: vm-x-ai.example.com
    gateway:
      name: vm-x-ai-gateway
      namespace: istio-system
      selector:
        istio: ingressgateway
      servers:
        - port:
            number: 80
            name: http
            protocol: HTTP
        - port:
            number: 443
            name: https
            protocol: HTTPS
          tls:
            mode: SIMPLE
            credentialName: vm-x-ai-tls # Must exist in istio-system namespace

    virtualService:
      gateways:
        - istio-system/vm-x-ai-gateway

      trafficPolicy:
        loadBalancer:
          simple: LEAST_CONN
        connectionPool:
          tcp:
            maxConnections: 100
        outlierDetection:
          consecutive5xxErrors: 3
          interval: 30s
          baseEjectionTime: 30s
          maxEjectionPercent: 50
          minHealthPercent: 50

# Enable OTEL for observability
otel:
  enabled: true
  collector:
    enabled: true
  jaeger:
    enabled: true
  prometheus:
    enabled: true
    persistence:
      enabled: true
      size: 100Gi
      storageClass: 'fast-ssd'
  loki:
    enabled: true
    persistence:
      enabled: true
      size: 200Gi
      storageClass: 'fast-ssd'
  grafana:
    enabled: true
    persistence:
      enabled: true
      size: 20Gi
      storageClass: 'fast-ssd'

# Security: Use external secrets in production
# Each secret can have its own method: "create", "external", or "eso"
# Option 1: Reference existing Kubernetes secrets
secrets:
  database:
    method: external
    external:
      secretName: 'postgresql-credentials' # Create this secret separately
      passwordKey: 'password'
  questdb:
    method: external
    external:
      secretName: 'questdb-credentials'
      passwordKey: 'password'
  ui:
    method: create
  # Libsodium encryption key (only needed if using libsodium provider)
  # For production with AWS KMS, this section is not needed
  libsodium:
    method: create
# Option 2: Use External Secrets Operator (uncomment to use)
# secrets:
#   database:
#     method: eso
#     externalSecrets:
#       secretKey: "vmxai/production/postgresql"
#       passwordKey: "password"
#   questdb:
#     method: eso
#     externalSecrets:
#       secretKey: "vmxai/production/questdb"
#       passwordKey: "password"
#   ui:
#     method: create
#   externalSecrets:
#     enabled: true
#     secretStore:
#       name: "aws-secrets-manager"
#       kind: SecretStore
